<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crypto Signal Scanner</title>
  <style>
    body {
      background-color: #121212;
      color: #d1d5db;
      font-family: monospace;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 1rem;
    }
    h1 {
      color: #10b981;
      text-align: center;
    }
    select, button {
      background-color: #1f2937;
      color: #d1d5db;
      border: 1px solid #374151;
      padding: 0.5rem;
      margin-right: 0.5rem;
      border-radius: 0.375rem;
    }
    button:hover {
      background-color: #374151;
    }
    #log {
      margin-top: 1rem;
      color: #93c5fd;
      white-space: pre-line;
    }
    #progress {
      width: 100%;
      height: 10px;
      background-color: #374151;
      margin-top: 1rem;
      border-radius: 5px;
      overflow: hidden;
    }
    #progress-bar {
      height: 100%;
      width: 0%;
      background-color: #10b981;
      transition: width 0.4s ease;
    }
    #signals .signal {
      background-color: #1f2937;
      border: 1px solid #374151;
      border-radius: 0.5rem;
      margin-top: 1rem;
      padding: 1rem;
    }
    #signals button {
      margin: 0.5rem 0.5rem 0 0;
    }
    #chart iframe {
      width: 100%;
      height: 400px;
      border: none;
      margin-top: 1rem;
      border-radius: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“Š Crypto Signal Scanner</h1>

    <div>
      <label for="tradeType">Trade Type:</label>
      <select id="tradeType">
        <option value="long">Long</option>
        <option value="short">Short</option>
      </select>

      <label for="timeframe">Timeframe:</label>
      <select id="timeframe">
        <option value="5m">5 Minutes</option>
        <option value="15m">15 Minutes</option>
        <option value="1h">1 Hour</option>
      </select>

      <button onclick="startIndicatorScan()">Start Indicator Scan</button>
    </div>

    <div id="progress">
      <div id="progress-bar"></div>
    </div>

    <pre id="log"></pre>

    <h2>Signals Found:</h2>
    <div id="signals"></div>

    <h2>Chart:</h2>
    <div id="chart"></div>
  </div>

  <script>
    function addSignal(text, iframeHTML, details) {
      const signalDiv = document.createElement("div");
      signalDiv.className = "signal";
      const signalText = document.createElement("div");
      signalText.textContent = text;
      signalDiv.appendChild(signalText);

      const btns = document.createElement("div");

      const showChartBtn = document.createElement("button");
      showChartBtn.innerText = "Show Chart";
      showChartBtn.onclick = (e) => {
        e.stopPropagation();
        document.getElementById("chart").innerHTML = iframeHTML;
      };

      const showDetailsBtn = document.createElement("button");
      showDetailsBtn.innerText = "Show Details";
      showDetailsBtn.onclick = (e) => {
        e.stopPropagation();
        alert(
          `ðŸ“Œ Entry: ${details.entry}\nðŸŽ¯ Target: ${details.target}\nðŸ›‘ Stoploss: ${details.stoploss}`
        );
      };

      btns.appendChild(showChartBtn);
      btns.appendChild(showDetailsBtn);
      signalDiv.appendChild(btns);

      document.getElementById("signals").appendChild(signalDiv);
    }

    async function getCurrentPrice(symbol) {
      const response = await fetch(
        `https://api.binance.com/api/v3/ticker/price?symbol=${symbol}`
      );
      const data = await response.json();
      return parseFloat(data.price);
    }

    async function startIndicatorScan() {
      const tradeType = document.getElementById("tradeType").value;
      const timeframe = document.getElementById("timeframe").value;
      const logEl = document.getElementById("log");
      const progress = document.getElementById("progress-bar");
      const signalsEl = document.getElementById("signals");
      signalsEl.innerHTML = "";
      document.getElementById("chart").innerHTML = "";

      logEl.innerText = "ðŸ”Ž Scanning indicator signals...";
      progress.style.width = "20%";

      // Simulate scanning delay
      setTimeout(async () => {
        progress.style.width = "70%";
        logEl.innerText = "âœ… Scan complete. Validating signals...";

        const exampleSignals = [
          {
            symbol: "BTCUSDT",
            entry: 107312.70,
            target: 107350.60,
            stoploss: 107292.48,
            iframe: `<iframe src="https://www.tradingview.com/chart/?symbol=BINANCE:BTCUSDT"></iframe>`,
          },
          {
            symbol: "ETHUSDT",
            entry: 3800.00,
            target: 3900.00,
            stoploss: 3750.00,
            iframe: `<iframe src="https://www.tradingview.com/chart/?symbol=BINANCE:ETHUSDT"></iframe>`,
          },
        ];

        let validSignals = 0;

        for (const signal of exampleSignals) {
          const price = await getCurrentPrice(signal.symbol);

          const isLongValid = tradeType === "long" && (price < signal.target && price > signal.entry);
          const isShortValid = tradeType === "short" && (price > signal.target && price < signal.entry);

          if (isLongValid || isShortValid) {
            addSignal(
              `ðŸ“ˆ ${tradeType.toUpperCase()} signal on ${signal.symbol} (${timeframe})`,
              signal.iframe,
              signal
            );
            validSignals++;
          }
        }

        if (validSignals === 0) {
          logEl.innerText = "âš ï¸ No actionable signals found: current market prices have already hit targets or crossed stoploss.";
        } else {
          logEl.innerText += `\nâœ… Showing ${validSignals} actionable signal(s).`;
        }

        progress.style.width = "100%";
      }, 1500);
    }
  </script>
</body>
</html>
