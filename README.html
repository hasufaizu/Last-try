<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICT Daily Bias Analyst</title>
    <style>
        :root {
            --ict-gold: #c5a059;
            --bg-dark: #121212;
            --card-bg: #1e1e1e;
            --text: #e0e0e0;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg-dark); color: var(--text); display: flex; justify-content: center; padding: 20px; }
        .card { background: var(--card-bg); padding: 2rem; border-radius: 12px; border: 1px solid #333; width: 100%; max-width: 600px; }
        h2 { color: var(--ict-gold); text-align: center; text-transform: uppercase; letter-spacing: 2px; }
        input, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 6px; border: 1px solid #444; box-sizing: border-box; background: #2a2a2a; color: white; }
        button { background: var(--ict-gold); color: black; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #e2b86a; }
        button:disabled { background: #555; cursor: not-allowed; }
        #preview { width: 100%; border-radius: 8px; margin-top: 15px; border: 1px dashed #555; display: none; }
        #status { font-weight: bold; color: var(--ict-gold); margin: 15px 0; text-align: center; }
        #result { background: #111; padding: 20px; border-radius: 8px; border-left: 4px solid var(--ict-gold); white-space: pre-wrap; font-size: 15px; line-height: 1.6; }
    </style>
</head>
<body>

<div class="card">
    <h2>ICT Bias Analyst</h2>
    <input type="password" id="apiKey" placeholder="Enter Gemini API Key">
    <label style="font-size: 12px; color: #888;">Upload 1D Chart Screenshot:</label>
    <input type="file" id="imageInput" accept="image/*">
    <img id="preview">
    <button id="scanBtn">ANALYZE DAILY BIAS</button>
    <div id="status"></div>
    <div id="result">Analysis will appear here...</div>
</div>

<script>
    const imageInput = document.getElementById('imageInput');
    const preview = document.getElementById('preview');
    const scanBtn = document.getElementById('scanBtn');
    const resultDiv = document.getElementById('result');
    const statusDiv = document.getElementById('status');
    const apiKeyInput = document.getElementById('apiKey');

    imageInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = e => {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(file);
        }
    });

    scanBtn.addEventListener('click', async () => {
        const key = apiKeyInput.value.trim();
        const file = imageInput.files[0];

        if (!key || !file) {
            alert("API Key and Chart Image required.");
            return;
        }

        statusDiv.innerText = "‚è≥ SCANNING PRICE ACTION...";
        resultDiv.innerText = "";
        scanBtn.disabled = true;

        const ICT_PROMPT = `Act as a professional ICT (Inner Circle Trader) analyst. Please analyze the attached 1D (Daily) chart and determine the Daily Bias for the next trading session based on the following three filters.
1. DAILY TF FVGs: Identify the most recent Fair Value Gaps. Is price currently reacting off a bullish FVG (discount) or a bearish FVG (premium)? Is there an unfilled FVG acting as a magnet?
2. IRL TO ERL AND ERL TO IRL: Identify the current Narrative. Is price moving from Internal Range Liquidity (FVGs/Balanced Price Ranges) toward External Range Liquidity (Old Highs/Lows), or has it just swept External Liquidity and is now gravitating back to an Internal Fair Value Gap?
3. ICT DAILY CANDLE CLOSING CONCEPT: Look at the most recent completed 1D candle. If it closed above the high of the previous candle, the bias is bullish. If it closed below the low of the previous candle, the bias is bearish.

Please provide the output in this exact format:
FVG FILTER: [Analyze if price is supported by/rejected by a Daily FVG and identify the next FVG draw on liquidity]
IRL & ERL FILTER: [State whether price is currently in an IRL-to-ERL expansion or an ERL-to-IRL retracement]
CANDLE CLOSING FILTER: [Note the close of the previous candle relative to the prior candle's range]
FINAL BIAS: [Bullish / Bearish / Neutral]`;

        try {
            const base64Data = await new Promise((resolve) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result.split(',')[1]);
                reader.readAsDataURL(file);
            });

            // Using gemini-2.0-flash for latest vision capabilities
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [
                            { text: ICT_PROMPT },
                            { inline_data: { mime_type: file.type, data: base64Data } }
                        ]
                    }]
                })
            });

            const data = await response.json();

            if (data.error) throw new Error(data.error.message);

            const text = data.candidates[0].content.parts[0].text;
            statusDiv.innerText = "üéØ ANALYSIS COMPLETE";
            resultDiv.innerText = text;

        } catch (err) {
            statusDiv.innerText = "‚ùå ERROR";
            resultDiv.innerText = err.message;
        } finally {
            scanBtn.disabled = false;
        }
    });
</script>

</body>
</html>
