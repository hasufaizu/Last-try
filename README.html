<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Image Fix</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f9; display: flex; justify-content: center; padding: 20px; }
        .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 450px; }
        input, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
        button { background: #1a73e8; color: white; border: none; font-weight: bold; cursor: pointer; }
        button:disabled { background: #ccc; }
        #preview { width: 100%; border-radius: 8px; margin-top: 10px; display: none; }
        #status { font-weight: bold; color: #1a73e8; margin-top: 10px; }
        #result { background: #eee; padding: 15px; border-radius: 8px; margin-top: 10px; white-space: pre-wrap; font-size: 14px; }
    </style>
</head>
<body>

<div class="card">
    <h2>Gemini Vision</h2>
    <input type="password" id="apiKey" placeholder="Paste Gemini API Key Here">
    <input type="file" id="imageInput" accept="image/*">
    <img id="preview">
    <button id="scanBtn">Scan Image</button>
    <div id="status"></div>
    <div id="result">Results will appear here...</div>
</div>

<script>
    const imageInput = document.getElementById('imageInput');
    const preview = document.getElementById('preview');
    const scanBtn = document.getElementById('scanBtn');
    const resultDiv = document.getElementById('result');
    const statusDiv = document.getElementById('status');
    const apiKeyInput = document.getElementById('apiKey');

    // Handle Image Preview
    imageInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = e => {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(file);
        }
    });
// ... (rest of your code above stays the same)

scanBtn.addEventListener('click', async () => {
    const key = apiKeyInput.value.trim();
    const file = imageInput.files[0];

    if (!key || !file) {
        alert("Please provide both an API key and an image.");
        return;
    }

    statusDiv.innerText = "⏳ Analyzing image... please wait.";
    resultDiv.innerText = "";
    scanBtn.disabled = true;

    try {
        const base64Data = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result.split(',')[1]);
            reader.readAsDataURL(file);
        });

        // UPDATED: Changed model name to gemini-2.5-flash
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{
                    parts: [
                        { text: "What is in this image? Provide a concise description." },
                        { inline_data: { mime_type: file.type, data: base64Data } }
                    ]
                }]
            })
        });

        const data = await response.json();

        if (data.error) {
            // This will show you exactly what the API is complaining about
            throw new Error(`API Error: ${data.error.message} (Code: ${data.error.code})`);
        }

        const text = data.candidates[0].content.parts[0].text;
        statusDiv.innerText = "✅ Done!";
        resultDiv.innerText = text;

    } catch (err) {
        statusDiv.innerText = "❌ Error occurred";
        resultDiv.innerText = err.message;
        console.error(err);
    } finally {
        scanBtn.disabled = false;
    }
});
    
            
</script>

</body>
</html>
